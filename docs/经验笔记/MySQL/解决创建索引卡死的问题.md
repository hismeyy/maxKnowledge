---
title: 解决创建索引卡死的问题
sidebar: heading
---

# 解决创建索引卡死的问题

因上级安排，需要通过身份证字段联查两张表并将结果导出到Excel。两张表的数据量分别约为 800 万条 和 300 万条 。如果进行全表扫描，速度会非常慢。因此，需要为这两张表的身份证字段创建索引。然而，创建索引的线程被锁定，导致等待一整晚索引也没有成功创建。因此有了这篇文档。

## 创建索引卡死的原因分析

- **数据量过大**：当表中的数据量非常大的时候，创建索引就需要很长的时间，就可能会导致卡死；
- **索引冲突**：如果表中已经存在重复的数据，创建唯一索引时可能会卡死；
- **锁冲突**：如果其他事务正在对表进行操作，创建索引时可能会被锁住，导致卡死；
- **硬件资源不足**：服务器的CPU、内存、磁盘等资源不足，也可能导致索引创建卡死。

## 解决方案

1. 在创建索引的时候需要先确定硬件资源是否足够；
2. 检查数据库和表状态是否正常；
3. 确定要创建索引的表，并找到需要创建索引的列；
4. 对数据进行备份，防止出现问题；
5. 使用 `SHOW PROCESSLIST` 命令查看MySQL当前正在执行的线程，查看表是否被其他线程所操作；
6. 如果有其他线程正在操作表，可以等待其线程完成后再尝试创建索引，或者使用 `KILL` 命令终止其他线程；
7. 如果没有其他线程正在操作表，使用 `ALTER TABLE` 语句创建索引。

## 可能会用到的命令
```cmd
SHOW DATABASES;

USE your_database_name;

SHOW TABLES;

DESCRIBE your_table_name;

CREATE TABLE your_table_name_backup AS SELECT * FROM your_table_name;

SHOW PROCESSLIST;

KILL process_id;

ALTER TABLE your_table_name ADD INDEX index_name (column_name);
```

## 平时注意防止慢查询
1. 优化自己的SQL语句；
2. 创建数据库的时候，考虑好，提前添加索引。
